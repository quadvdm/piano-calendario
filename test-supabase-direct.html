<!DOCTYPE html>
<html>
<head>
    <title>Test Supabase Directo - CORREGIDO</title>
</head>
<body>
    <h1>Test Supabase sin onclick - VERSI√ìN CORREGIDA</h1>
    <button id="loginBtn">Login Google</button>
    
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0;"></div>
    
    <!-- Cargar Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        console.log('=== INICIANDO TEST SUPA BASE CORREGIDO ===');
        
        // SOLUCI√ìN: Verificar si 'supabase' ya existe antes de declararlo
        if (typeof supabase !== 'undefined') {
            console.warn('‚ö†Ô∏è "supabase" ya est√° definido. Usando variable existente.');
            // Si ya existe, no la redeclares
        }
        
        // Crear cliente - SIN 'const' si ya existe
        let supabaseClient; // Usar nombre diferente para evitar conflicto
        
        try {
            supabaseClient = window.supabase.createClient(
                'https://yhwtlbcckdegbggjaems.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlod3RsYmNja2RlZ2JnZ2phZW1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NDQyODIsImV4cCI6MjA4MTUyMDI4Mn0.ab35WTtpZGJ4VP-3Dkr0SdQN5hK5ZC5uxeVLJiarWs8'
            );
            
            console.log('‚úÖ Cliente Supabase creado:', supabaseClient ? 'S√ç' : 'NO');
            document.getElementById('result').innerHTML = '‚úÖ Cliente Supabase inicializado';
            
        } catch (error) {
            console.error('‚ùå Error creando cliente:', error);
            document.getElementById('result').innerHTML = '‚ùå Error: ' + error.message;
        }
        
        // Event listener directo - USAR supabaseClient (no supabase)
        document.getElementById('loginBtn').addEventListener('click', async function() {
            console.log('üîµ Bot√≥n clickeado - iniciando login');
            document.getElementById('result').innerHTML = 'üîÑ Conectando con Google...';
            
            // Verificar que el cliente existe
            if (!supabaseClient) {
                document.getElementById('result').innerHTML = '‚ùå Error: Cliente Supabase no inicializado';
                return;
            }
            
            try {
                const { error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: 'https://lovely-lamington-133500.netlify.app'
                    }
                });
                
                if (error) {
                    console.error('‚ùå Error OAuth:', error);
                    document.getElementById('result').innerHTML = '‚ùå Error: ' + error.message;
                    
                    // Ayuda espec√≠fica
                    if (error.message.includes('redirect_uri')) {
                        document.getElementById('result').innerHTML += 
                            '<br><br>‚ö†Ô∏è Configura Google Cloud con:<br>' +
                            '<code>https://yhwtlbcckdegbggjaems.supabase.co/auth/v1/callback</code>';
                    }
                } else {
                    console.log('‚úÖ Redirecci√≥n iniciada');
                    document.getElementById('result').innerHTML = '‚úÖ Redirigiendo a Google...';
                }
            } catch (err) {
                console.error('‚ùå Error inesperado:', err);
                document.getElementById('result').innerHTML = '‚ùå Error inesperado: ' + err.message;
            }
        });
        
        console.log('‚úÖ Setup completo - bot√≥n listo');
    </script>
</body>
</html>
